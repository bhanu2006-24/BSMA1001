<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Builder | Curriculum Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <style>
        :root { --accent: #6366f1; --bg: #09090b; --panel: #18181b; --border: #27272a; }
        body { font-family: 'Space Grotesk', sans-serif; background-color: var(--bg); color: #e4e4e7; }
        
        .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; }
        .input-dark { background: #09090b; border: 1px solid var(--border); color: #eee; padding: 0.6rem; width: 100%; border-radius: 8px; outline: none; transition: border-color 0.2s; }
        .input-dark:focus { border-color: var(--accent); }
        
        .btn-primary { background: var(--accent); color: white; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; font-size: 0.9em; transition: 0.2s; }
        .btn-primary:hover { filter: brightness(1.1); }
        
        .btn-ghost { background: transparent; color: #a1a1aa; padding: 0.5rem; border-radius: 6px; transition: 0.2s; }
        .btn-ghost:hover { background: #27272a; color: white; }

        .drag-handle { cursor: grab; color: #52525b; }
        .drag-handle:active { cursor: grabbing; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
    </style>
    
    <script type="importmap">
        {
            "imports": {
                "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
            }
        }
    </script>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <div id="app" class="flex-1 flex flex-col h-full">
        
        <!-- Header -->
        <header class="h-16 shrink-0 border-b border-[#27272a] bg-[#09090b] flex justify-between items-center px-6 z-20">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-lg bg-indigo-600 flex items-center justify-center text-white font-bold"><i class="fa-solid fa-cube"></i></div>
                <div>
                    <h1 class="text-white font-bold tracking-tight text-sm">Universal Builder</h1>
                    <p class="text-[10px] text-gray-500 font-mono">{{ course.meta.title || 'Untitled' }}</p>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <span v-if="unsavedChanges" class="text-amber-500 text-xs font-bold animate-pulse">‚óè Unsaved</span>
                <button @click="saveData" class="btn-primary flex items-center gap-2">
                    <i class="fa-solid fa-save"></i> Save JSON
                </button>
                <div class="w-[1px] h-6 bg-[#27272a]"></div>
                <a href="index.html" target="_blank" class="btn-ghost" title="Preview">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i>
                </a>
            </div>
        </header>

        <div class="flex-1 flex overflow-hidden">
            
            <!-- Left Sidebar -->
            <aside class="w-80 bg-[#121214] border-r border-[#27272a] flex flex-col p-4 z-10">
                <div class="mb-4 flex justify-between items-center">
                    <h2 class="text-xs font-bold text-gray-500 uppercase tracking-widest">Structure</h2>
                    <button @click="showAddMenu = !showAddMenu" class="text-xs text-indigo-400 font-bold hover:text-indigo-300 transition">+ Add Section</button>
                </div>
                
                <div v-if="showAddMenu" class="mb-4 grid grid-cols-2 gap-2 bg-[#18181b] p-2 rounded-lg border border-[#27272a] animate-fade-in">
                    <button @click="addSection('text')" class="text-xs p-2 rounded hover:bg-[#27272a] text-left"><i class="fa-solid fa-paragraph w-5 text-gray-400"></i> Text/About</button>
                    <button @click="addSection('module')" class="text-xs p-2 rounded hover:bg-[#27272a] text-left"><i class="fa-solid fa-layer-group w-5 text-gray-400"></i> Module</button>
                    <button @click="addSection('compiler')" class="text-xs p-2 rounded hover:bg-[#27272a] text-left"><i class="fa-solid fa-code w-5 text-gray-400"></i> Compiler</button>
                    <button @click="addSection('faq')" class="text-xs p-2 rounded hover:bg-[#27272a] text-left"><i class="fa-solid fa-circle-question w-5 text-gray-400"></i> FAQ</button>
                </div>

                <div class="flex-1 overflow-y-auto space-y-2 pr-2 section-list" ref="sortableList">
                    <div @click="activeSection = 'meta'" :class="['p-3 rounded-lg border cursor-pointer flex items-center gap-3 transition', activeSection === 'meta' ? 'bg-indigo-900/10 border-indigo-500/50' : 'bg-[#18181b] border-transparent hover:border-[#3f3f46]']">
                        <i class="fa-solid fa-gear text-gray-500"></i>
                        <span class="text-sm font-medium">Global Settings</span>
                    </div>
                    
                    <div v-for="(sec, idx) in course.sections" :key="sec.id" 
                        @click="activeSection = sec.id"
                        :class="['p-3 rounded-lg border cursor-pointer flex items-center justify-between group transition relative', activeSection === sec.id ? 'bg-[#18181b] border-indigo-500 active' : 'bg-[#18181b] border-transparent hover:border-[#3f3f46]']"
                        :data-id="sec.id">
                        
                        <div class="flex items-center gap-3 overflow-hidden">
                            <i class="fa-solid fa-grip-vertical drag-handle hover:text-white"></i>
                            <div class="truncate">
                                <div class="text-sm font-medium text-gray-200 truncate">{{ sec.title || 'Untitled' }}</div>
                                <div class="text-[10px] text-gray-500 font-mono uppercase">{{ sec.type }}</div>
                            </div>
                        </div>
                        <button @click.stop="deleteSection(idx)" class="btn-ghost opacity-0 group-hover:opacity-100 p-1"><i class="fa-solid fa-trash text-xs"></i></button>
                    </div>
                </div>
            </aside>

            <!-- Main Editor -->
            <main class="flex-1 overflow-y-auto bg-[#09090b] p-8 lg:p-12">
                <div class="max-w-4xl mx-auto">
                    
                    <!-- Global Settings -->
                    <div v-if="activeSection === 'meta'" class="space-y-6 animate-fade-in">
                        <h2 class="text-2xl font-bold text-white mb-6">Course Settings</h2>
                        <div class="panel p-6 space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs font-bold text-gray-500 uppercase mb-2 block">Course Title</label>
                                    <input v-model="course.meta.title" class="input-dark">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-500 uppercase mb-2 block">Subtitle / Term</label>
                                    <input v-model="course.meta.subtitle" class="input-dark">
                                </div>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase mb-2 block">Accent Color</label>
                                <div class="flex gap-2">
                                    <input type="color" v-model="course.meta.accentColor" class="h-10 w-10 bg-transparent border-none rounded cursor-pointer">
                                    <input v-model="course.meta.accentColor" class="input-dark font-mono uppercase">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section Editors -->
                    <div v-else-if="currentSection" class="space-y-6 animate-fade-in pb-24">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-white">{{ currentSection.title }}</h2>
                            <span class="text-xs font-mono bg-[#18181b] border border-[#27272a] px-2 py-1 rounded text-gray-500 uppercase">{{ currentSection.type }} Section</span>
                        </div>

                        <div class="panel p-6 mb-6">
                            <label class="text-xs font-bold text-gray-500 uppercase mb-2 block">Section Title</label>
                            <input v-model="currentSection.title" class="input-dark text-lg font-bold">
                        </div>

                        <!-- TEXT -->
                        <div v-if="currentSection.type === 'text'" class="panel p-6 flex flex-col h-[60vh]">
                            <label class="text-xs font-bold text-gray-500 uppercase mb-2 block flex justify-between">
                                <span>Markdown Content</span>
                                <i class="fa-brands fa-markdown text-xl opacity-50"></i>
                            </label>
                            <textarea v-model="currentSection.content" class="input-dark flex-1 font-mono text-sm resize-none p-4 leading-relaxed" placeholder="# Header..."></textarea>
                        </div>

                        <!-- MODULE -->
                        <div v-if="currentSection.type === 'module'" class="space-y-4">
                            <div class="panel p-6 overflow-hidden">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-sm font-bold text-gray-400 uppercase">Module Content</h3>
                                    <div class="flex gap-2">
                                        <button @click="addItem(currentSection, 'video')" class="text-xs bg-[#27272a] hover:bg-[#3f3f46] px-3 py-1.5 rounded transition text-white">+ Video</button>
                                        <button @click="addItem(currentSection, 'resource')" class="text-xs bg-[#27272a] hover:bg-[#3f3f46] px-3 py-1.5 rounded transition text-white">+ File</button>
                                        <button @click="addItem(currentSection, 'quiz')" class="text-xs bg-[#27272a] hover:bg-[#3f3f46] px-3 py-1.5 rounded transition text-white">+ Quiz</button>
                                    </div>
                                </div>

                                <div class="space-y-2">
                                    <div v-for="(item, idx) in currentSection.items" :key="idx" class="flex items-center gap-3 bg-[#18181b] p-3 rounded-lg border border-[#27272a] group">
                                         <div v-if="item.type === 'video'" class="w-8 h-8 rounded bg-red-900/20 text-red-500 flex items-center justify-center"><i class="fa-brands fa-youtube"></i></div>
                                         <div v-else-if="item.type === 'resource'" class="w-8 h-8 rounded bg-green-900/20 text-green-500 flex items-center justify-center"><i class="fa-solid fa-file"></i></div>
                                         <div v-else class="w-8 h-8 rounded bg-orange-900/20 text-orange-500 flex items-center justify-center"><i class="fa-solid fa-list-check"></i></div>
                                         
                                         <div class="flex-1 grid gap-1">
                                             <input v-model="item.title" class="bg-transparent text-sm font-bold text-white outline-none placeholder-gray-600" placeholder="Item Title">
                                             <input v-model="item.url" class="bg-transparent text-xs font-mono text-gray-500 outline-none placeholder-gray-700 w-full" placeholder="URL / Link">
                                         </div>
                                         <button @click="currentSection.items.splice(idx, 1)" class="btn-ghost text-gray-600 hover:text-red-500"><i class="fa-solid fa-xmark"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- COMPILER -->
                        <div v-if="currentSection.type === 'compiler'" class="panel p-6">
                            <div class="grid grid-cols-2 gap-6">
                                <div>
                                    <label class="text-xs font-bold text-gray-500 uppercase mb-2 block">Language</label>
                                    <select v-model="currentSection.language" class="input-dark">
                                        <option value="python">Python</option>
                                        <option value="javascript">JavaScript</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-500 uppercase mb-2 block">Starter Code</label>
                                    <textarea v-model="currentSection.starterCode" class="input-dark h-32 font-mono text-xs"></textarea>
                                </div>
                            </div>
                        </div>

                    </div>
                    
                    <div v-else class="text-center py-24 text-gray-600">
                        <p>Select a section to edit.</p>
                    </div>

                </div>
            </main>
        </div>
    </div>

    <!-- Script Imports -->
    <script type="module">
        import { createApp } from 'vue';
        import { loadCourse, exportCourse } from './src/js/course_data.js';

        createApp({
            data() {
                return {
                    course: { meta: {}, sections: [] },
                    activeSection: 'meta',
                    showAddMenu: false,
                    unsavedChanges: false
                }
            },
            computed: {
                currentSection() {
                    return this.course.sections.find(s => s.id === this.activeSection);
                }
            },
            watch: {
                course: {
                    handler() { this.unsavedChanges = true; },
                    deep: true
                }
            },
            async mounted() {
                this.course = await loadCourse();
                
                this.$nextTick(() => {
                    const el = this.$refs.sortableList;
                    if(el) {
                        new Sortable(el, {
                            handle: '.drag-handle',
                            animation: 150,
                            onEnd: (evt) => {
                                const item = this.course.sections.splice(evt.oldIndex, 1)[0]; 
                                this.course.sections.splice(evt.newIndex, 0, item);
                                this.unsavedChanges = true;
                            }
                        });
                    }
                });
                
                this.$nextTick(() => this.unsavedChanges = false);
            },
            methods: {
                saveData() {
                    exportCourse(this.course);
                    this.unsavedChanges = false;
                },
                addSection(type) {
                    const newIds = 'sec_' + Date.now();
                    const newSec = {
                        id: newIds,
                        type,
                        title: 'New ' + type.charAt(0).toUpperCase() + type.slice(1),
                    };
                    
                    if(type === 'text') newSec.content = '# New Info';
                    if(type === 'module') newSec.items = [];
                    if(type === 'compiler') { newSec.language = 'python'; newSec.starterCode = 'print("Hello World")'; }
                    
                    this.course.sections.push(newSec);
                    this.activeSection = newIds;
                    this.showAddMenu = false;
                },
                deleteSection(idx) {
                    if(confirm("Delete this section?")) {
                        const id = this.course.sections[idx].id;
                        this.course.sections.splice(idx, 1);
                        if(this.activeSection === id) this.activeSection = 'meta';
                    }
                },
                addItem(sec, type) {
                    if(!sec.items) sec.items = [];
                    sec.items.push({ type, title: 'New Item', url: '' });
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
