<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Page - StudyWithUS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Python support -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>

    <script type="importmap">
        {
            "imports": {
                "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
            }
        }
    </script>
    
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f9fafb; color: #333; }
        
        /* IITM Style Accents */
        .brand-header { background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .nav-link { color: #555; font-weight: 500; font-size: 0.9em; text-transform: uppercase; }
        .nav-link:hover { color: #800000; } /* Maroon accent often used by IITs */
        
        .course-hero { background: linear-gradient(135deg, #800000 0%, #a52a2a 100%); color: white; padding: 3rem 0; }
        .chip { background: rgba(255,255,255,0.2); padding: 0.2rem 0.6rem; border-radius: 4px; font-size: 0.8rem; font-weight: 500; }
        
        .section-title { font-size: 1.25rem; font-weight: 700; color: #444; margin-bottom: 1rem; border-left: 4px solid #800000; padding-left: 0.75rem; }
        
        .week-card { background: white; border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 0.75rem; overflow: hidden; }
        .week-header { background: #f8f9fa; padding: 1rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 500; }
        .week-header:hover { background: #f0f0f0; }

        .btn-primary { background-color: #800000; color: white; padding: 0.5rem 1rem; border-radius: 4px; font-weight: 500; transition: background 0.2s; }
        .btn-primary:hover { background-color: #600000; }
        
        /* Playground Editor */
        .editor-container { font-family: 'Fira Code', monospace; background: #1e1e1e; color: #d4d4d4; border-radius: 8px; overflow: hidden; }
        .editor-line { display: flex; }
        .line-num { width: 30px; text-align: right; padding-right: 10px; color: #6e7681; user-select: none; }
        textarea.code-input { background: transparent; color: inherit; border: none; width: 100%; outline: none; resize: none; line-height: 1.5; font-family: inherit; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div id="app" class="flex flex-col flex-1">
        
        <!-- Navigation -->
        <nav class="brand-header sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <span class="text-xl font-bold text-[#800000]">IITM BS Degree</span>
                    <span class="text-gray-400 text-sm">| StudyWithUS</span>
                </div>
                <div class="hidden md:flex items-center gap-8">
                    <a href="#" class="nav-link">Home</a>
                    <a href="#" class="nav-link">Academics</a>
                    <a href="#" class="nav-link text-[#800000]">Course Page</a>
                    <a href="editor.html" class="nav-link border border-gray-300 px-3 py-1 rounded hover:bg-gray-50">Instructor Login</a>
                </div>
            </div>
        </nav>

        <div v-if="course">
            <!-- Hero Section -->
            <header class="course-hero">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="text-xs uppercase tracking-widest opacity-80 mb-2">{{ course.info.type }} Level Course</div>
                    <h1 class="text-4xl font-bold mb-4">{{ course.info.title }}</h1>
                    
                    <div class="flex flex-wrap gap-4 text-sm mb-6">
                        <div class="flex items-center gap-2">
                            <span class="opacity-70">Instructors:</span>
                            <span class="font-medium" v-for="(inst, idx) in course.info.instructors" :key="idx">
                                <a :href="inst.profileLink" target="_blank" class="underline hover:text-gray-200">{{ inst.name }}</a>{{ idx < course.info.instructors.length - 1 ? ',' : '' }}
                            </span>
                        </div>
                    </div>

                    <div class="flex gap-3">
                        <span class="chip">ID: {{ course.info.code }}</span>
                        <span class="chip">{{ course.info.credits }} Credits</span>
                        <span class="chip">Prereq: {{ course.info.prerequisites }}</span>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 grid grid-cols-1 lg:grid-cols-3 gap-10">
                
                <!-- Left Column (Tabs & Info) -->
                <div class="col-span-2 space-y-10">
                    
                    <!-- Tabs -->
                    <div class="flex border-b border-gray-200">
                        <button @click="activeTab = 'content'" 
                            :class="['px-6 py-3 font-medium text-sm transition border-b-2', activeTab === 'content' ? 'border-[#800000] text-[#800000]' : 'border-transparent text-gray-500 hover:text-gray-800']">
                            Course Content
                        </button>
                        <button @click="activeTab = 'playground'" 
                            :class="['px-6 py-3 font-medium text-sm transition border-b-2 flex items-center gap-2', activeTab === 'playground' ? 'border-[#800000] text-[#800000]' : 'border-transparent text-gray-500 hover:text-gray-800']">
                            <i class="fa-solid fa-code"></i> Code Playground
                        </button>
                    </div>

                    <!-- Course Content Tab -->
                    <div v-if="activeTab === 'content'" class="animate-fade-in space-y-8">
                        <div>
                            <h2 class="section-title">About the Course</h2>
                            <p class="text-gray-600 leading-relaxed">{{ course.info.description }}</p>
                        </div>

                        <div>
                            <h2 class="section-title">What you'll learn</h2>
                            <div class="flex justify-end mb-2">
                                <button @click="expandAll = !expandAll" class="text-xs text-[#800000] font-bold hover:underline">{{ expandAll ? '- Collapse All' : '+ Show all weeks' }}</button>
                            </div>
                            
                            <div v-for="(week, idx) in course.weeks" :key="idx" class="week-card">
                                <div class="week-header" @click="week.isOpen = !week.isOpen">
                                    <span class="text-gray-800">Week {{ idx + 1 }}: {{ week.title }}</span>
                                    <i class="fa-solid fa-chevron-down text-gray-400 transition-transform" :class="{'rotate-180': week.isOpen || expandAll}"></i>
                                </div>
                                <div v-if="week.isOpen || expandAll" class="p-5 border-t border-gray-100 bg-white">
                                    <div class="prose prose-sm max-w-none text-gray-600 mb-4" v-html="renderMd(week.desc || '')"></div>
                                    
                                    <div v-if="week.content && week.content.length" class="space-y-2">
                                        <h4 class="text-xs font-bold text-gray-400 uppercase">Module Items</h4>
                                        <div v-for="item in week.content" :key="item.id" class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded">
                                            <i v-if="item.type === 'video'" class="fa-brands fa-youtube text-red-600 w-5"></i>
                                            <i v-else-if="item.type === 'resource'" class="fa-solid fa-file-pdf text-red-800 w-5"></i>
                                            <i v-else class="fa-solid fa-circle text-gray-400 w-5"></i>
                                            
                                            <span class="text-sm font-medium text-gray-700">{{ item.title }}</span>
                                            
                                            <a v-if="item.url" :href="item.url" target="_blank" class="text-xs text-[#800000] underline ml-auto">View</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div v-if="!course.weeks || course.weeks.length === 0" class="text-gray-500 italic text-sm p-4 border rounded bg-gray-50">
                                Course curriculum is yet to be updated.
                            </div>
                        </div>
                    </div>

                    <!-- Code Playground Tab -->
                    <div v-if="activeTab === 'playground'" class="animate-fade-in space-y-6">
                        <div class="bg-blue-50 border border-blue-200 rounded p-4 text-sm text-blue-800">
                            <i class="fa-solid fa-info-circle mr-1"></i> Practice computing concepts directly in your browser. Python support is enabled via Pyodide.
                        </div>

                        <div class="flex gap-4 mb-2">
                            <select v-model="codeLang" class="border border-gray-300 rounded px-2 py-1 text-sm bg-white">
                                <option value="javascript">JavaScript</option>
                                <option value="python">Python</option>
                            </select>
                            <button @click="runCode" class="btn-primary text-sm flex items-center gap-2">
                                <i class="fa-solid fa-play"></i> Run Code
                            </button>
                        </div>

                        <div class="editor-container h-80 relative">
                            <textarea v-model="code" class="code-input h-full w-full p-4 font-mono text-sm" spellcheck="false" placeholder="# Type your code here..."></textarea>
                        </div>

                        <div class="bg-black text-green-400 font-mono text-sm p-4 rounded min-h-[100px] whitespace-pre-wrap border border-gray-800 shadow-inner">
                            <div v-if="output">{{ output }}</div>
                            <div v-if="error" class="text-red-400">{{ error }}</div>
                            <div v-if="!output && !error" class="text-gray-600 opacity-50">// Output will appear here</div>
                        </div>
                    </div>

                </div>

                <!-- Right Column (Sidebar) -->
                <div class="space-y-8">
                    
                    <!-- Grading -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <h3 class="font-bold text-gray-800 mb-4 border-b pb-2">Course Structure & Grading</h3>
                        <p class="text-sm text-gray-600 leading-relaxed">{{ course.grading }}</p>
                        <a href="#" class="block mt-4 text-xs font-bold text-[#800000] hover:underline">View Assessent Details &rarr;</a>
                    </div>

                    <!-- Books -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <h3 class="font-bold text-gray-800 mb-4 border-b pb-2">Books & References</h3>
                        <ul class="space-y-4">
                            <li v-for="(book, idx) in course.books" :key="idx" class="text-sm">
                                <span class="block font-medium text-gray-900">{{ book.title }}</span>
                                <span class="block text-gray-500 text-xs mt-1">by {{ book.author }}</span>
                                <a v-if="book.link" :href="book.link" class="inline-block mt-1 text-[#800000] text-xs font-bold">[DOWNLOAD]</a>
                            </li>
                        </ul>
                    </div>
                </div>

            </main>
        </div>
        
        <footer class="bg-gray-100 py-8 border-t border-gray-200 mt-auto">
             <div class="max-w-7xl mx-auto px-4 text-center text-sm text-gray-500">
                 &copy; 2025 StudyWithUS (Community Project). Not officially affiliated with IIT Madras.
             </div>
        </footer>

    </div>

    <script type="module">
        import { createApp } from 'vue';
        import { loadCourse } from './src/course_data.js';
        import { CodeCompiler } from './src/compiler.js';
        import { renderMarkdown, configureMarkdown } from './src/md.js';

        const compiler = new CodeCompiler();
        configureMarkdown();

        createApp({
            data() {
                return {
                    course: null,
                    activeTab: 'content',
                    expandAll: false,
                    code: 'print("Hello World")',
                    codeLang: 'python',
                    output: '',
                    error: ''
                }
            },
            async mounted() {
                this.course = await loadCourse();
                // Preload Python if possible
                compiler.initPython(); 
            },
            watch: {
                codeLang(newVal) {
                    if(newVal === 'python') this.code = 'print("Hello Python")';
                    else this.code = 'console.log("Hello JS")';
                }
            },
            methods: {
                renderMd(text) { return renderMarkdown(text); },
                async runCode() {
                    this.output = 'Running...';
                    this.error = '';
                    
                    const res = await compiler.run(this.code, this.codeLang);
                    this.output = res.output;
                    this.error = res.error;
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
